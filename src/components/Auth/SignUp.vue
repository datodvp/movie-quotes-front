<script setup>
import PopUpCard from '../PopUpCard.vue'
import TextInput from '../Form/TextInput.vue'
import { Form } from 'vee-validate'
import { ref } from 'vue';
import PrimaryButton from '../Buttons/PrimaryButton.vue';
import SecondaryButton from '../Buttons/SecondaryButton.vue'
import IconGoogle from '../icons/IconGoogle.vue';
import { useAuthService } from '../../services/useAuthService'
import { useRouter } from 'vue-router';
import ServerErrorMessage from '../ServerErrorMessage.vue';

const authService = useAuthService()
const router = useRouter()

const username = ref('')
const email = ref('')
const password = ref('')
const passwordConfirmation = ref('')

const errorMessage = ref('')

const register = async (values) => {
    try {
        await authService.register(values)
        router.push({ name: 'mailSent' })
    } catch (error) {
        errorMessage.value = error.response.data.message
    }
}

const registerGoogle = async () => {
    authService.authGoogle()
}
</script>

<template>
    <PopUpCard>
        <div class="flex flex-col items-center justify-center w-full">
            <h1 class="p-4 text-3xl font-medium">Create an account</h1>
            <p class="p-4 text-[#6C757D] mt-3">Start your journey!</p>
            <Form @submit="register" class="w-full px-4 md:px-0">

                <TextInput label="Name" name="username" placeholder="At least 3 & max.15 lower case characters"
                    v-model="username" :rules="{ required: true, min: 3, max: 15, latin: true }" />
                <TextInput label="Email" name="email" placeholder="Enter your email" v-model="email"
                    :rules="{ required: true, email: true }" />
                <TextInput type="password" label="Password" name="password"
                    placeholder="At least 8 & max.15 lower case characters" v-model="password"
                    :rules="{ required: true, latin: true, min: 8, max: 15 }" />
                <TextInput type="password" label="Confirm password" name="password_confirmation"
                    placeholder="Confirm password" v-model="passwordConfirmation"
                    :rules="{ required: true, confirmed: 'password' }" />

                <ServerErrorMessage :errorMessage="errorMessage" />

                <PrimaryButton class="mt-6"><button>Get Started</button></PrimaryButton>

                <SecondaryButton @click="registerGoogle" class="mt-4">

                    <button type="button">
                        <IconGoogle class="mr-2" />Sign up with Google
                    </button>
                </SecondaryButton>

                <div class="flex justify-center gap-1 mt-8">
                    <p>Already have an account?</p>
                    <RouterLink to="/login" class="text-[#0D6EFD] underline">Log in</RouterLink>
                </div>
            </Form>
        </div>
    </PopUpCard>
</template>